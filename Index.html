<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Juego del Impostor</title>

<style>
    * {
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        user-select: none;
    }

    body {
        margin: 0;
        font-family: 'Arial', sans-serif;
        background: #1c1c1e;
        color: white;
    }

    .container {
        max-width: 500px;
        margin: auto;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-top: 30px;
        font-size: 32px;
        font-weight: bold;
    }

    .settings {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 26px;
        cursor: pointer;
    }

    .bubble {
        background: #2a2a2d;
        border-radius: 40px;
        padding: 18px 22px;
        margin: 12px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 20px;
        box-shadow: 0px 4px 8px rgba(0,0,0,0.25);
    }

    .delete {
        font-size: 24px;
        cursor: pointer;
    }

    .addPlayerBox {
        display: flex;
        align-items: center;
        margin-top: 20px;
    }

    .inputBubble {
        flex: 1;
        background: #2a2a2d;
        border-radius: 40px;
        padding: 18px;
        border: none;
        outline: none;
        color: white;
        font-size: 18px;
    }

    .addBtn {
        background: #2a2a2d;
        margin-left: 12px;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 28px;
        cursor: pointer;
        box-shadow: 0px 4px 8px rgba(0,0,0,0.25);
    }

    .continueBtn {
        background: white;
        color: black;
        padding: 20px;
        border-radius: 40px;
        font-size: 22px;
        font-weight: bold;
        text-align: center;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: calc(100% - 60px);
        max-width: 500px;
        cursor: pointer;
        display: none;
    }

    .smallMessage {
        text-align: center;
        margin-top: 40px;
        opacity: 0.8;
    }

    #adminPanel { display: none; }

    .card {
        background: #2a2a2d;
        padding: 20px;
        border-radius: 20px;
        margin-top: 20px;
    }

    .wordItem {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        background: #1e1e23;
        border-radius: 15px;
        margin: 8px 0;
    }

    #configScreen { display: none; }

    .configBox {
        background: #2a2a2d;
        padding: 20px;
        border-radius: 20px;
        margin-bottom: 22px;
        text-align: center;
    }

    .configTitle {
        font-size: 22px;
        margin-bottom: 12px;
    }

    .configControls {
        display: flex;
        justify-content: center;
        gap: 25px;
        align-items: center;
    }

    .configBtn {
        background: #1e1e23;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        font-size: 28px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }

    .configValue {
        font-size: 30px;
        min-width: 40px;
    }
</style>

</head>
<body>

<div class="settings" onclick="showAdmin()">⚙️</div>

<div class="container">

    <div id="playersScreen">
        <h1>Jugadores</h1>

        <div id="playersList"></div>

        <div class="addPlayerBox">
            <input id="playerInput" class="inputBubble" placeholder="Nombre del jugador">
            <div class="addBtn" onclick="addPlayer()">+</div>
        </div>

        <p id="msg" class="smallMessage">Agrega al menos 3 jugadores para continuar</p>
    </div>

    <div id="continueBtn" class="continueBtn" onclick="goToConfig()">
        CONTINUAR
    </div>

    <div id="adminPanel">
        <h1>Administrador</h1>

        <div class="card">
            <h2>Palabras</h2>
            <input id="wordInput" class="inputBubble" placeholder="Nueva palabra">
            <div class="addBtn" onclick="addWord()">+</div>

            <div id="wordList"></div>
        </div>

        <div class="continueBtn" style="position: relative; display:block; margin-top: 30px;"
             onclick="closeAdmin()">
            Regresar
        </div>
    </div>

    <div id="configScreen">
        <h1>Configuración</h1>

        <div class="configBox">
            <div class="configTitle">Número de impostores</div>
            <div class="configControls">
                <div class="configBtn" onclick="changeImpostors(-1)">−</div>
                <div class="configValue" id="impostorCount">1</div>
                <div class="configBtn" onclick="changeImpostors(1)">+</div>
            </div>
        </div>

        <div class="configBox">
            <div class="configTitle">Duración (minutos)</div>
            <div class="configControls">
                <div class="configBtn" onclick="changeTime(-1)">−</div>
                <div class="configValue" id="roundTime">1</div>
                <div class="configBtn" onclick="changeTime(1)">+</div>
            </div>
        </div>

        <!-- BOTÓN BAJADO UN POCO -->
        <div class="continueBtn" style="position: relative; margin-top: 60px; display:block;" onclick="startGame()">
            COMENZAR JUEGO
        </div>

    </div>

</div>

<div id="gameScreen" style="display:none; text-align:center; padding-top:40px;">

    <h1 id="currentPlayerName"></h1>

    <div id="holdButton" 
         style="
            margin: 50px auto;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background:#2a2a2d;
            display:flex;
            justify-content:center;
            align-items:center;
            font-size:22px;
            box-shadow:0px 4px 10px rgba(0,0,0,0.4);
            cursor:pointer;
            user-select:none;
            touch-action:none;
         "
         onmousedown="showWord()" 
         onmouseup="hideWord()"
         ontouchstart="showWord()" 
         ontouchend="hideWord()">
        Mantén presionado
    </div>

    <div id="wordBox" style="display:none; font-size:26px; margin-top:20px;"></div>

    <div id="nextPlayerBtn"
         style="
            display:none;
            background:white;
            color:black;
            padding:18px;
            border-radius:40px;
            width:200px;
            margin:30px auto;
            font-size:20px;
            cursor:pointer;
         "
         onclick="nextPlayer()">
        Siguiente jugador
    </div>

    <!-- TEMPORIZADOR -->
    <h2 id="timer" style="display:none; margin-top:20px; opacity:0.9;"></h2>

    <!-- BOTÓN PARA MOSTRAR IMPOSTORES -->
    <div id="revealBtn"
         style="
            display:none;
            background:white;
            color:black;
            padding:18px;
            border-radius:40px;
            width:260px;
            margin:30px auto;
            font-size:20px;
            cursor:pointer;
         "
         onclick="revealImpostors()">
        Descubrir impostor(es)
    </div>

    <!-- NUEVO: REINICIAR -->
    <div id="restartBtn"
         style="
            display:none;
            background:white;
            color:black;
            padding:18px;
            border-radius:40px;
            width:220px;
            margin:10px auto;
            font-size:20px;
            cursor:pointer;
         "
         onclick="restartGame()">
        Reiniciar juego
    </div>

</div>

<script>
let players = [];
let words = [];

function addPlayer() {
    const name = playerInput.value.trim();
    if (!name) return;

    players.push(name);
    playerInput.value = "";
    renderPlayers();
}

function deletePlayer(i) {
    players.splice(i, 1);
    renderPlayers();
}

function renderPlayers() {
    playersList.innerHTML = "";

    players.forEach((p, i) => {
        playersList.innerHTML += `
            <div class="bubble">
                ${p}
                <span class="delete" onclick="deletePlayer(${i})">×</span>
            </div>
        `;
    });

    if (players.length >= 3) {
        continueBtn.style.display = "block";
        msg.style.display = "none";
    } else {
        continueBtn.style.display = "none";
        msg.style.display = "block";
    }
}

function showAdmin() {
    playersScreen.style.display = "none";
    adminPanel.style.display = "block";
    configScreen.style.display = "none";
}

function closeAdmin() {
    adminPanel.style.display = "none";
    playersScreen.style.display = "block";
}

function addWord() {
    const w = wordInput.value.trim();
    if (!w) return;

    words.push(w);
    wordInput.value = "";
    renderWords();
}

function deleteWord(i) {
    words.splice(i, 1);
    renderWords();
}

function renderWords() {
    wordList.innerHTML = "";
    words.forEach((w, i) => {
        wordList.innerHTML += `
            <div class="wordItem">
                ${w}
                <span class="delete" onclick="deleteWord(${i})">×</span>
            </div>
        `;
    });
}

let impostors = 1;
let timeMinutes = 1;

function goToConfig() {
    playersScreen.style.display = "none";
    adminPanel.style.display = "none";
    configScreen.style.display = "block";
    continueBtn.style.display = "none";
}

function changeImpostors(val) {
    impostors += val;
    if (impostors < 1) impostors = 1;
    if (impostors >= players.length) impostors = players.length - 1;
    impostorCount.textContent = impostors;
}

function changeTime(val) {
    timeMinutes += val;
    if (timeMinutes < 1) timeMinutes = 1;
    if (timeMinutes > 15) timeMinutes = 15;
    roundTime.textContent = timeMinutes;
}

let currentIndex = 0;
let impostorIndices = [];
let gameWord = "";
let timerInterval = null;
let remainingSeconds = 0;

function startGame() {
    playersScreen.style.display = "none";
    adminPanel.style.display = "none";
    configScreen.style.display = "none";
    gameScreen.style.display = "block";

    gameWord = words.length ? words[Math.floor(Math.random() * words.length)] : "Sin palabras";

    impostorIndices = [];
    let temp = [...Array(players.length).keys()];

    for (let i = 0; i < impostors; i++) {
        let r = Math.floor(Math.random() * temp.length);
        impostorIndices.push(temp[r]);
        temp.splice(r, 1);
    }

    currentIndex = 0;
    loadPlayer();
}

function loadPlayer() {
    currentPlayerName.textContent = players[currentIndex];
    wordBox.style.display = "none";
    nextPlayerBtn.style.display = "none";
    nextPlayerBtn.textContent = "Siguiente jugador";
    nextPlayerBtn.onclick = () => nextPlayer();
}

function showWord() {
    if (impostorIndices.includes(currentIndex)) {
        wordBox.textContent = "IMPOSTOR";
    } else {
        wordBox.textContent = gameWord;
    }
    wordBox.style.display = "block";
}

function hideWord() {
    wordBox.style.display = "none";
    nextPlayerBtn.style.display = "block";
}

function nextPlayer() {
    currentIndex++;

    if (currentIndex >= players.length) {
        nextPlayerBtn.textContent = "COMENZAR";
        nextPlayerBtn.onclick = () => beginTimer();
        return;
    }

    loadPlayer();
}

/* ========= TEMPORIZADOR ========= */

function beginTimer() {
    holdButton.style.display = "none";
    nextPlayerBtn.style.display = "none";
    currentPlayerName.textContent = "Tiempo en curso";

    remainingSeconds = timeMinutes * 60;
    timer.style.display = "block";

    updateTimer();

    timerInterval = setInterval(() => {
        remainingSeconds--;
        updateTimer();

        if (remainingSeconds <= 0) {
            clearInterval(timerInterval);
            timer.textContent = "Tiempo finalizado";
            revealBtn.style.display = "block";
        }
    }, 1000);
}

function updateTimer() {
    let m = Math.floor(remainingSeconds / 60);
    let s = remainingSeconds % 60;
    timer.textContent = `${m}:${s.toString().padStart(2, "0")}`;
}

/* ========= MOSTRAR IMPOSTORES ========= */

function revealImpostors() {
    let names = impostorIndices.map(i => players[i]).join(", ");
    alert("Los impostores eran: " + names);

    revealBtn.style.display = "none";
    restartBtn.style.display = "block";
}

/* ========= NUEVO: REINICIAR ========= */

function restartGame() {
    gameScreen.style.display = "none";
    playersScreen.style.display = "block";

    restartBtn.style.display = "none";
    timer.style.display = "none";

    remainingSeconds = 0;
    clearInterval(timerInterval);
}
</script>

</body>
</html>
