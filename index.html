<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>El Impostor</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
    /* ----------------------------------------------------
       VARIABLES & TEMAS
    ---------------------------------------------------- */
    :root {
        --bg-color: #f8fafc;
        --card-bg: #ffffff;
        --card-border: #e2e8f0;
        --card-shadow: 0 20px 40px -10px rgba(148, 163, 184, 0.15);
        
        --text-main: #0f172a; 
        --text-muted: #64748b;
        
        --input-bg: #f1f5f9;
        --input-border: transparent;
        
        --item-bg: #ffffff;
        --item-border: #f1f5f9;

        /* MODO CLARO (#00ABE4) */
        --accent: #00ABE4; 
        --accent-soft: rgba(0, 171, 228, 0.08);
        --accent-glow: rgba(0, 171, 228, 0.4);
        
        --danger: #ef4444;
        --danger-soft: rgba(239, 68, 68, 0.1);
        --danger-glow: rgba(239, 68, 68, 0.4);
        
        --dot-color: #cbd5e1;
    }

    html.dark {
        --bg-color: #020617; 
        --card-bg: #0f172a;
        --card-border: #1e293b;
        --card-shadow: 0 20px 40px -10px rgba(0,0,0,0.6);
        
        --text-main: #f8fafc; 
        --text-muted: #94a3b8;
        
        --input-bg: #1e293b;
        --input-border: transparent;
        
        --item-bg: #1e293b;
        --item-border: #334155;

        /* MODO OSCURO (#2272FF) */
        --accent: #3b82f6; 
        --accent-soft: rgba(59, 130, 246, 0.15);
        --accent-glow: rgba(59, 130, 246, 0.5);
        
        --dot-color: #1e293b;
    }

    /* ----------------------------------------------------
       COMPORTAMIENTO NATIVO Y PROTECCI√ìN CSS
    ---------------------------------------------------- */
    * { 
        -webkit-tap-highlight-color: transparent; 
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    input, select { 
        -webkit-user-select: text; 
        user-select: text; 
    }
    img, a {
        -webkit-user-drag: none;
        user-drag: none;
        pointer-events: none;
    }
    button svg { pointer-events: none; }

    html::-webkit-scrollbar, body::-webkit-scrollbar, .app::-webkit-scrollbar, ul::-webkit-scrollbar, *::-webkit-scrollbar { 
        display: none; width: 0 !important; height: 0 !important; background: transparent !important; -webkit-appearance: none !important; 
    }
    html, body, .app, ul { scrollbar-width: none; -ms-overflow-style: none; }

    html, body {
        height: 100dvh;
        width: 100vw;
        margin: 0;
        font-family: 'Outfit', sans-serif;
        background-color: var(--bg-color);
        background-image: radial-gradient(var(--dot-color) 1.5px, transparent 1.5px);
        background-size: 32px 32px;
        background-attachment: fixed;
        color: var(--text-main);
        overflow-x: hidden; 
        overflow-y: auto; 
        overscroll-behavior-y: none;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch; 
        transition: color 0.4s ease, background-color 0.4s ease;
        cursor: default; 
        touch-action: pan-x pan-y; /* Bloqueo de zoom CSS */
    }

    .app {
        max-width: 440px;
        width: 100%;
        min-height: 100dvh; 
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    .spacer { flex: 1; }

    /* --- HEADER --- */
    header { 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        margin-top: 10px;
        margin-bottom: 20px;
        flex-shrink: 0; 
    }
    
    .logo-area h1 { 
        font-size: 26px; 
        font-weight: 800;
        margin: 0; 
        color: var(--text-main);
        letter-spacing: -0.03em;
        line-height: 1;
    }

    .logo-area .sub { 
        color: var(--text-muted); 
        font-size: 13px; 
        font-weight: 500;
        margin-top: 4px;
        letter-spacing: 0.05em;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background-color: var(--accent);
        border-radius: 50%;
        display: inline-block;
        margin-left: 6px;
        box-shadow: 0 0 10px var(--accent);
        animation: breath 2s infinite;
    }
    @keyframes breath { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }

    .dark-toggle {
        cursor: pointer;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        width: 48px;
        height: 48px;
        border-radius: 16px;
        position: relative;
        color: var(--text-main);
        overflow: hidden;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: var(--card-shadow);
    }
    .dark-toggle:hover { transform: scale(1.05); }
    .dark-toggle:active { transform: scale(0.95); }

    .dark-toggle svg {
        width: 22px;
        height: 22px;
        stroke-width: 2px;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
        stroke: currentColor;
        position: absolute;
        top: 50%;
        left: 50%;
        transition: all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    .icon-moon { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) scale(1); }
    .icon-sun { opacity: 0; transform: translate(-50%, -50%) rotate(90deg) scale(0.5); }
    html.dark .icon-moon { opacity: 0; transform: translate(-50%, -50%) rotate(-90deg) scale(0.5); }
    html.dark .icon-sun { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) scale(1); }


    /* --- TARJETAS --- */
    .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 28px;
        padding: 24px;
        box-shadow: var(--card-shadow);
        margin-bottom: 16px;
        height: auto; 
        overflow: visible;
        animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        backdrop-filter: blur(20px);
    }

    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(20px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    label { display: block; font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 10px; padding-left: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

    input, select {
        width: 100%;
        padding: 16px 20px;
        border-radius: 18px;
        border: 2px solid transparent; 
        background: var(--input-bg);
        color: var(--text-main);
        font-size: 16px; 
        font-family: 'Outfit', sans-serif;
        font-weight: 500;
        box-sizing: border-box;
        outline: none;
        transition: all 0.2s ease;
    }
    input:focus, select:focus {
        background: var(--card-bg);
        border-color: var(--accent);
        box-shadow: 0 4px 20px var(--accent-soft);
    }
    
    ::placeholder { color: var(--text-muted); opacity: 0.6; }

    /* --- BOTONES --- */
    button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px 24px;
        border-radius: 18px;
        background: transparent;
        border: 2px solid var(--accent);
        color: var(--accent);
        font-weight: 700;
        font-family: 'Outfit', sans-serif;
        font-size: 15px;
        cursor: pointer;
        letter-spacing: 0.02em;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 4px 15px var(--accent-soft);
        min-height: 56px; 
        box-sizing: border-box;
    }
    
    button:active { transform: scale(0.96); }
    
    button:hover {
        background: var(--accent-soft);
        box-shadow: 0 8px 25px var(--accent-soft);
    }

    button.ghost {
        border-color: var(--card-border);
        color: var(--text-muted);
        box-shadow: none;
    }
    button.ghost:hover {
        border-color: var(--text-muted);
        color: var(--text-main);
        background: var(--input-bg);
    }
    
    button.danger {
        border-color: var(--danger);
        color: var(--danger);
        box-shadow: 0 4px 15px var(--danger-soft);
    }
    button.danger:hover {
        background: var(--danger-soft);
        box-shadow: 0 8px 25px var(--danger-soft);
    }

    .hold-btn {
        width: 100%;
        padding: 40px 20px;
        border: 2px dashed var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: none;
        display: flex;
    }
    .hold-btn:active {
        background: var(--accent);
        color: white;
        border-style: solid;
        transform: scale(0.98);
    }

    .btn-locked {
        background: var(--input-bg) !important;
        border-color: var(--input-bg) !important;
        color: var(--text-muted) !important;
        pointer-events: none;
        box-shadow: none !important;
        opacity: 0.6;
    }

    .row { display: flex; gap: 10px; }
    
    .smallbtn { 
        padding: 0; 
        width: 54px;
        height: 54px;
        font-size: 26px; 
        border-radius: 18px;
        flex-shrink: 0;
        min-height: 54px;
    }

    ul { padding: 0; margin: 10px 0 0 0; list-style: none; }
    
    li { 
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--item-bg);
        border: 1px solid var(--item-border);
        padding: 14px 18px;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 500;
        animation: slideInLeft 0.3s ease;
    }

    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .actions { display: flex; align-items: center; gap: 4px; }

    .btn-icon {
        border: none;
        background: transparent;
        padding: 8px;
        border-radius: 12px;
        color: var(--text-muted);
        box-shadow: none;
        width: auto; height: auto;
        min-height: auto;
    }
    .btn-icon:hover { background: var(--input-bg); color: var(--text-main); }
    .btn-delete:hover { background: var(--danger-soft); color: var(--danger); }

    .assign-name { 
        font-size: 42px; 
        font-weight: 900; 
        color: var(--text-main);
        text-align: center;
        margin: 30px 0;
        line-height: 1;
        letter-spacing: -1.5px;
    }
    
    /* CAJA DE REVELAR */
    .reveal {
        margin-top: 0; 
        padding: 40px 24px;
        border-radius: 24px;
        background: var(--accent-soft);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 2px solid var(--accent);
        text-align: center;
        display: none;
        min-height: 120px;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        animation: boxPulse 2s infinite;
        width: 100%;
        box-sizing: border-box;
    }

    @keyframes boxPulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-soft); }
        50% { transform: scale(1.02); box-shadow: 0 0 20px var(--accent-soft); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-soft); }
    }

    .reveal-title { font-size: 14px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; }
    .reveal-word { font-size: 32px; font-weight: 800; color: var(--text-main); }

    .reveal.impostor-mode {
        background: var(--danger-soft);
        border-color: var(--danger);
        animation: dangerPulse 1.5s infinite;
    }
    
    .reveal-impostor-text {
        font-size: 36px;
        font-weight: 900;
        color: var(--danger); 
        letter-spacing: -1px;
        text-shadow: 0 4px 20px var(--danger-glow);
    }

    @keyframes dangerPulse {
        0% { box-shadow: 0 0 0 0 var(--danger-soft); transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { box-shadow: 0 0 0 15px transparent; transform: scale(1); }
    }

    .timer-wrap { display: flex; flex-direction: column; gap: 12px; align-items: center; margin: 20px 0; }
    .timer-number { font-size: 72px; font-weight: 900; color: var(--text-main); font-variant-numeric: tabular-nums; line-height: 1; }
    .bar-outer { width: 100%; height: 12px; background: var(--input-bg); border-radius: 99px; overflow: hidden; }
    .bar-inner { 
        height: 100%; width: 100%; 
        background: linear-gradient(90deg, var(--danger) 0%, var(--accent) 100%);
        border-radius: 99px;
        transition: width 0.1s linear; 
    }

    .controls { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px; align-items: stretch; }

    .vote-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }

    .vote-card {
        background: var(--item-bg);
        border: 2px solid var(--item-border);
        border-radius: 20px;
        padding: 24px 10px;
        text-align: center;
        color: var(--text-main);
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 80px;
    }
    
    .vote-card:active { transform: scale(0.95); }

    .vote-card.voted {
        background: var(--accent-soft);
        color: var(--accent); 
        border-color: var(--accent);
        transform: scale(1.02);
        box-shadow: 0 10px 25px var(--accent-soft);
    }

    .vote-grid.has-selection .vote-card:not(.voted) { opacity: 0.4; transform: scale(0.95); filter: grayscale(1); }

    .result-text { font-size: 24px; font-weight: 800; color: var(--text-main); margin: 10px 0; line-height: 1.3; }
    
    .footer {
        text-align: center;
        margin-top: auto;
        padding: 20px 0;
        color: var(--text-muted);
        font-size: 12px;
        font-weight: 500;
        opacity: 0.7;
    }

    /* ----------------------------------------------------
       ESTILOS DEL "TOAST" (ACTION SHEET & NOTIFICACI√ìN)
    ---------------------------------------------------- */
    .toast-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        backdrop-filter: blur(4px);
        z-index: 999;
        display: none;
        align-items: flex-end; /* Alineado abajo */
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .toast-overlay.active { display: flex; opacity: 1; }

    .toast-content {
        width: 100%;
        max-width: 440px;
        background: var(--card-bg);
        border-top-left-radius: 32px;
        border-top-right-radius: 32px;
        padding: 32px 24px;
        box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        border-top: 1px solid var(--card-border);
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        text-align: center;
    }
    .toast-overlay.active .toast-content { transform: translateY(0); }

    .toast-title { font-size: 22px; font-weight: 800; margin-bottom: 8px; color: var(--text-main); }
    .toast-msg { font-size: 15px; color: var(--text-muted); margin-bottom: 24px; }

    /* NUEVO: Notificaci√≥n flotante superior (estilo p√≠ldora) */
    .toast-notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-150%);
        background: var(--text-main);
        color: var(--bg-color);
        padding: 14px 24px;
        border-radius: 99px;
        font-weight: 700;
        font-size: 14px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 2000;
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: flex;
        align-items: center;
        gap: 12px;
        pointer-events: none;
        white-space: nowrap;
    }
    .toast-notification.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
    .toast-icon { font-size: 18px; }

</style>
</head>
<body>
<div class="app">

    <header>
        <div class="logo-area">
            <h1>El Impostor<span class="status-dot"></span></h1>
            <div class="sub">TRAKAS HDSPM</div>
        </div>
        
        <button class="dark-toggle" onclick="toggleDarkMode()" title="Cambiar tema">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
    </header>

    <div id="admin" class="card">
        <label>A√±adir palabra</label>
        <div class="row">
            <input type="text" id="nuevaPalabra" placeholder="Ej. Cybertruck, Zumpango..." />
            <button class="smallbtn" onclick="agregarPalabra()">+</button>
        </div>
        <ul id="listaPalabras"></ul>
        
        <hr style="margin:24px 0; border:none; border-top:1px solid var(--card-border)" />
        
        <label>A√±adir jugador</label>
        <div class="row">
            <input type="text" id="nombreJugador" placeholder="Nombre del jugador" />
            <button class="smallbtn" onclick="agregarJugador()">+</button>
        </div>
        <ul id="listaJugadores"></ul>
        
        <div style="margin-top:24px" class="row">
            <div style="flex:1">
                <label>Tiempo ronda</label>
                <select id="duracionSelect">
                    <option value="60" selected>1 minuto</option>
                    <option value="120">2 minutos</option>
                    <option value="180">3 minutos</option>
                    <option value="240">4 minutos</option>
                    <option value="300">5 minutos</option>
                </select>
            </div>
            <div style="align-self:flex-end">
                <button style="width:100%" onclick="iniciarJuego()">¬°Jugar!</button>
            </div>
        </div>
        <div style="margin-top:16px" class="row">
            <button class="danger ghost" style="flex:1" onclick="mostrarConfirmacion()">Reset Total</button>
        </div>
    </div>

    <div id="asignacion" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center; opacity:0.6;">
            <div style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:1px;">Turno de</div>
            <div style="font-size:14px; font-variant-numeric: tabular-nums;">
                <span id="indiceAsignacion">1</span> / <span id="totalAsignacion">1</span>
            </div>
        </div>
        <div class="assign-name" id="nombreJugadorAsignacion">Jugador</div>
        
        <div style="display:flex; gap:16px; flex-direction:column; margin-top:10px;">
            <div style="position:relative; width:100%">
                <button id="btnReveal" class="hold-btn" oncontextmenu="return false;">MANT√âN PARA VER TU ROL</button>
                <div id="textoPalabra" class="reveal"></div>
            </div>
            <button id="btnSiguiente" onclick="siguienteJugador()" style="margin-top:8px; width:100%">Entendido, siguiente</button>
        </div>
    </div>

    <div id="pistas" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
                <div style="font-size:12px; color:var(--text-muted); font-weight:600; text-transform:uppercase">Go Go Go</div>
                <div style="font-weight:800; font-size:18px; color:var(--text-main)">Describan la palabra</div>
            </div>
        </div>
        
        <div class="timer-wrap">
            <div class="timer-number" id="timerNumber">60</div>
            <div class="bar-outer"><div id="timerBar" class="bar-inner"></div></div>
        </div>
        
        <div class="controls">
            <button id="botonIniciarTimer" style="flex:1.5" onclick="iniciarTemporizador()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Iniciar
            </button>
            <button class="ghost" style="flex:1" onclick="saltarAPuesta()">Votaci√≥n...</button>
        </div>
    </div>

    <div id="votacion" class="card" style="display:none">
         <div style="font-size:12px; color:var(--text-muted); font-weight:600; text-transform:uppercase; margin-bottom:4px;">Fase Final</div>
         <div style="font-weight:800; font-size:20px; color:var(--text-main); line-height:1.2;">¬øQui√©n es el impostor?</div>
         <div style="color:var(--text-muted); font-size:14px; margin-top:4px;">Toquen al sospechoso.</div>
         
         <div id="grillaVotacion" class="vote-grid"></div>
         
         <button onclick="finalizarJuegoSinVotos()" class="ghost" style="width:100%; margin-top:20px;">Saltar votaci√≥n</button>
    </div>

    <div id="resultado" class="card" style="display:none; text-align:center; padding-top:40px; padding-bottom:40px;">
        <div id="resultadoIcono" style="font-size:60px; margin-bottom:10px;">üëª</div>
        <div id="resultadoTitulo" class="result-text">El Impostor Gan√≥</div>
        <div id="resultadoMensaje" style="color:var(--text-muted); font-size:16px; margin-bottom:24px;">Nadie lo descubri√≥.</div>
        
        <div id="impostorGuessSection" style="display:none; margin-top:20px; border-top:1px solid var(--item-border); padding-top:20px;">
            <label id="impostorGuessLabel" style="color:var(--danger)">¬°Impostor! Adivina la palabra para ganar:</label>
            <div class="row">
                <input type="text" id="guessInput" placeholder="¬øCu√°l era la palabra?" />
                <button class="smallbtn" onclick="impostorAdivina()">?</button>
            </div>
            <div id="guessFeedback" style="margin-top:10px; font-weight:700;"></div>
        </div>

        <button onclick="mostrarSeccion('admin')" style="width:100%; margin-top:24px;">Jugar de nuevo</button>
    </div>

    <div class="spacer"></div>
    <div class="footer">
        Hecho con odio por tu ex.
    </div>

</div>

<div class="toast-overlay" id="confirmToast">
    <div class="toast-content">
        <div class="toast-title">¬øBorrar todo?</div>
        <div class="toast-msg">Se borrar√°n los jugadores y palabras guardadas.</div>
        <div class="row">
            <button class="ghost" style="flex:1" onclick="cerrarToast()">Cancelar</button>
            <button class="danger" style="flex:1" onclick="resetTotal()">S√≠, borrar</button>
        </div>
    </div>
</div>

<div id="notificationToast" class="toast-notification">
    <span id="toastIcon" class="toast-icon">‚ö†Ô∏è</span>
    <span id="toastMessage">Mensaje de alerta</span>
</div>

<script>
    /* -----------------------------------------------------------
       BLOQUEO DE ZOOM TOTAL (iOS y Android)
    ----------------------------------------------------------- */
    (function() {
        document.addEventListener('gesturestart', function(e) { e.preventDefault(); });
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) { event.preventDefault(); }
            lastTouchEnd = now;
        }, false);
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && (event.key === '+' || event.key === '-' || event.key === '0')) {
                event.preventDefault();
            }
        });
    })();

    /* -----------------------------------------------------------
       L√ìGICA DEL JUEGO
    ----------------------------------------------------------- */
    
    let jugadores = JSON.parse(localStorage.getItem('jugadores_impostor')) || [];
    let palabras = JSON.parse(localStorage.getItem('palabras_impostor')) || [];
    let impostor = "";
    let palabraSeleccionada = "";
    let turnoActual = 0;
    let jugadoresBarajados = [];
    let timerInterval;
    let timeLeft = 60;
    let totalTime = 60;

    // INICIO
    actualizarListas();

    function mostrarSeccion(id) {
        document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
        const s = document.getElementById(id);
        if(s) s.style.display = 'block';
    }

    function toggleDarkMode() {
        document.documentElement.classList.toggle('dark');
    }

    /* --- TOAST SYSTEM --- */
    function showToast(msg, icon = '‚ö†Ô∏è') {
        const t = document.getElementById('notificationToast');
        const m = document.getElementById('toastMessage');
        const i = document.getElementById('toastIcon');
        
        m.innerText = msg;
        i.innerText = icon;
        
        t.classList.add('show');
        if(navigator.vibrate) navigator.vibrate(50);
        
        setTimeout(() => {
            t.classList.remove('show');
        }, 3000);
    }

    /* --- ADMIN --- */
    function agregarPalabra() {
        const input = document.getElementById('nuevaPalabra');
        const val = input.value.trim();
        if(val) {
            palabras.push(val);
            localStorage.setItem('palabras_impostor', JSON.stringify(palabras));
            input.value = '';
            actualizarListas();
            showToast("Palabra guardada", "‚úÖ");
        } else {
            showToast("Escribe una palabra", "‚úçÔ∏è");
        }
    }

    function agregarJugador() {
        const input = document.getElementById('nombreJugador');
        const val = input.value.trim();
        if(val) {
            jugadores.push(val);
            localStorage.setItem('jugadores_impostor', JSON.stringify(jugadores));
            input.value = '';
            actualizarListas();
            showToast("Jugador a√±adido", "üë§");
        } else {
            showToast("Escribe un nombre", "‚úçÔ∏è");
        }
    }

    function actualizarListas() {
        const ulP = document.getElementById('listaPalabras');
        ulP.innerHTML = '';
        palabras.forEach((p, i) => {
            ulP.innerHTML += `
                <li>
                    <span>${p}</span>
                    <button class="btn-icon btn-delete" onclick="borrarPalabra(${i})">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                    </button>
                </li>`;
        });

        const ulJ = document.getElementById('listaJugadores');
        ulJ.innerHTML = '';
        jugadores.forEach((j, i) => {
            ulJ.innerHTML += `
                <li>
                    <span>${j}</span>
                    <button class="btn-icon btn-delete" onclick="borrarJugador(${i})">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                    </button>
                </li>`;
        });
    }

    function borrarPalabra(i) {
        palabras.splice(i, 1);
        localStorage.setItem('palabras_impostor', JSON.stringify(palabras));
        actualizarListas();
    }
    function borrarJugador(i) {
        jugadores.splice(i, 1);
        localStorage.setItem('jugadores_impostor', JSON.stringify(jugadores));
        actualizarListas();
    }

    /* --- RESET --- */
    function mostrarConfirmacion() {
        document.getElementById('confirmToast').classList.add('active');
    }
    function cerrarToast() {
        document.getElementById('confirmToast').classList.remove('active');
    }
    function resetTotal() {
        jugadores = [];
        palabras = [];
        localStorage.removeItem('jugadores_impostor');
        localStorage.removeItem('palabras_impostor');
        actualizarListas();
        cerrarToast();
        showToast("Todo borrado", "üóëÔ∏è");
    }

    /* --- JUEGO --- */
    function iniciarJuego() {
        if(jugadores.length < 3) { 
            showToast("M√≠nimo 3 jugadores", "üë•"); 
            return; 
        }
        if(palabras.length < 1) { 
            showToast("Faltan palabras", "üìù"); 
            return; 
        }

        palabraSeleccionada = palabras[Math.floor(Math.random() * palabras.length)];
        jugadoresBarajados = [...jugadores].sort(() => Math.random() - 0.5);
        impostor = jugadoresBarajados[Math.floor(Math.random() * jugadoresBarajados.length)];
        
        turnoActual = 0;
        document.getElementById('totalAsignacion').innerText = jugadoresBarajados.length;
        
        prepararTurno();
        mostrarSeccion('asignacion');
    }

    function prepararTurno() {
        const j = jugadoresBarajados[turnoActual];
        document.getElementById('nombreJugadorAsignacion').innerText = j;
        document.getElementById('indiceAsignacion').innerText = turnoActual + 1;
        
        const btnReveal = document.getElementById('btnReveal');
        const textoPalabra = document.getElementById('textoPalabra');
        const btnSiguiente = document.getElementById('btnSiguiente');
        
        textoPalabra.style.display = 'none';
        btnReveal.style.display = 'flex';
        btnSiguiente.classList.add('btn-locked');
        
        let holdTimer;
        
        const showRole = () => {
            btnReveal.style.display = 'none';
            textoPalabra.style.display = 'flex';
            
            textoPalabra.className = 'reveal'; 
            if(j === impostor) {
                textoPalabra.classList.add('impostor-mode');
                textoPalabra.innerHTML = `<div class="reveal-title">T√ö ERES EL</div><div class="reveal-impostor-text">IMPOSTOR</div>`;
            } else {
                textoPalabra.innerHTML = `<div class="reveal-title">LA PALABRA ES</div><div class="reveal-word">${palabraSeleccionada}</div>`;
            }
            
            setTimeout(() => {
                btnSiguiente.classList.remove('btn-locked');
            }, 500);
        };

        const startHold = (e) => {
            e.preventDefault();
            holdTimer = setTimeout(showRole, 600);
            btnReveal.style.transform = "scale(0.98)";
        };
        const endHold = (e) => {
            e.preventDefault();
            clearTimeout(holdTimer);
            btnReveal.style.transform = "scale(1)";
        };

        btnReveal.onmousedown = startHold;
        btnReveal.onmouseup = endHold;
        btnReveal.onmouseleave = endHold;
        btnReveal.ontouchstart = startHold;
        btnReveal.ontouchend = endHold;
    }

    function siguienteJugador() {
        turnoActual++;
        if(turnoActual < jugadoresBarajados.length) {
            prepararTurno();
        } else {
            configurarTimer();
            mostrarSeccion('pistas');
        }
    }

    /* --- TIMER --- */
    function configurarTimer() {
        const val = document.getElementById('duracionSelect').value;
        totalTime = parseInt(val);
        timeLeft = totalTime;
        actualizarVisualTimer();
        document.getElementById('botonIniciarTimer').style.display = 'flex';
        document.getElementById('timerBar').style.width = '100%';
    }

    function actualizarVisualTimer() {
        const min = Math.floor(timeLeft / 60);
        const sec = timeLeft % 60;
        document.getElementById('timerNumber').innerText = `${min}:${sec < 10 ? '0' : ''}${sec}`;
        const pct = (timeLeft / totalTime) * 100;
        document.getElementById('timerBar').style.width = `${pct}%`;
    }

    function iniciarTemporizador() {
        document.getElementById('botonIniciarTimer').style.display = 'none';
        timerInterval = setInterval(() => {
            timeLeft--;
            actualizarVisualTimer();
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                saltarAPuesta();
            }
        }, 1000);
    }

    /* --- VOTACI√ìN --- */
    function saltarAPuesta() {
        clearInterval(timerInterval);
        mostrarSeccion('votacion');
        generarGrillaVotacion();
    }

    function generarGrillaVotacion() {
        const grid = document.getElementById('grillaVotacion');
        grid.innerHTML = '';
        grid.className = 'vote-grid'; 
        
        jugadoresBarajados.forEach(j => {
            const btn = document.createElement('div');
            btn.className = 'vote-card';
            btn.innerText = j;
            btn.onclick = () => votarPor(j, btn);
            grid.appendChild(btn);
        });
    }

    function votarPor(sospechoso, btnElem) {
        const esImpostor = (sospechoso === impostor);
        const grid = document.getElementById('grillaVotacion');
        grid.classList.add('has-selection');
        btnElem.classList.add('voted');
        
        setTimeout(() => {
            mostrarResultadoFinal(esImpostor, sospechoso);
        }, 800);
    }

    function finalizarJuegoSinVotos() {
        mostrarResultadoFinal(false, null);
    }

    /* --- RESULTADOS --- */
    function mostrarResultadoFinal(impostorAtrapado, sospechosoElegido) {
        const titulo = document.getElementById('resultadoTitulo');
        const mensaje = document.getElementById('resultadoMensaje');
        const icono = document.getElementById('resultadoIcono');
        const guessSection = document.getElementById('impostorGuessSection');

        if(impostorAtrapado) {
            titulo.innerText = "¬°ATRAPADO!";
            titulo.style.color = "var(--accent)";
            icono.innerText = "üéâ";
            mensaje.innerHTML = `¬°Bien hecho! <strong>${impostor}</strong> era el impostor.<br><br>Pero espera... <br>Si el impostor adivina la palabra, ¬°GANA!`;
            
            guessSection.style.display = 'block';
            document.getElementById('guessFeedback').innerText = '';
            document.getElementById('guessInput').value = '';
        } 
        else {
            titulo.innerText = "GAN√ì EL IMPOSTOR";
            titulo.style.color = "var(--danger)";
            icono.innerText = "ü§´";
            
            if(sospechosoElegido) {
                mensaje.innerHTML = `Votaron por <strong>${sospechosoElegido}</strong>, pero era inocente.<br>El impostor era <strong style="color:var(--danger)">${impostor}</strong>.`;
            } else {
                mensaje.innerHTML = `El tiempo se acab√≥ (o saltaron).<br>El impostor era <strong style="color:var(--danger)">${impostor}</strong>.`;
            }
            guessSection.style.display = 'none';
        }
        mostrarSeccion('resultado');
    }

    function impostorAdivina(){
        const intento = document.getElementById('guessInput').value.trim();
        const feed = document.getElementById('guessFeedback');
        
        if(!intento){ showToast('Escribe algo primero', 'ü§î'); return; }
        
        if(intento.toLowerCase() === palabraSeleccionada.toLowerCase()){
            feed.style.color = '#10b981'; 
            feed.innerText = '¬°INCRE√çBLE! El Impostor adivin√≥ y GANA LA PARTIDA.';
            document.getElementById('resultadoTitulo').innerText = "EL IMPOSTOR ROB√ì LA VICTORIA";
            document.getElementById('resultadoTitulo').style.color = "var(--danger)";
        } else {
            feed.style.color = 'var(--danger)';
            feed.innerText = `Nop. Era "${palabraSeleccionada}". Ganaron los civiles.`;
        }
    }

    document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
    document.addEventListener('keydown', e => {
        if(e.key === 'Enter'){
            const f = document.activeElement;
            if(f.id === 'nuevaPalabra') agregarPalabra();
            if(f.id === 'nombreJugador') agregarJugador();
            if(f.id === 'guessInput') impostorAdivina();
        }
    });

</script>
</body>
</html>